/*! For license information please see game.js.LICENSE.txt */
(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t,n,r){return(n=function(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var a=r.call(t,n||"default");if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function n(){var e,t,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.toStringTag||"@@toStringTag";function c(n,a,o,i){var c=a&&a.prototype instanceof s?a:s,u=Object.create(c.prototype);return r(u,"_invoke",function(n,r,a){var o,i,c,s=0,u=a||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return o=t,i=0,c=e,f.n=n,l}};function p(n,r){for(i=n,c=r,t=0;!d&&s&&!a&&t<u.length;t++){var a,o=u[t],p=f.p,m=o[2];n>3?(a=m===r)&&(c=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=p&&((a=n<2&&p<o[1])?(i=0,f.v=r,f.n=o[1]):p<m&&(a=n<3||o[0]>r||r>m)&&(o[4]=n,o[5]=r,f.n=m,i=0))}if(a||n>1)return l;throw d=!0,r}return function(a,u,m){if(s>1)throw TypeError("Generator is already running");for(d&&1===u&&p(u,m),i=u,c=m;(t=i<2?e:c)||!d;){o||(i?i<3?(i>1&&(f.n=-1),p(i,c)):f.n=c:f.v=c);try{if(s=2,o){if(i||(a="next"),t=o[a]){if(!(t=t.call(o,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,i<2&&(i=0)}else 1===i&&(t=o.return)&&t.call(o),i<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==l)break}catch(t){o=e,i=1,c=t}finally{s=1}}return{value:t,done:d}}}(n,o,i),!0),u}var l={};function s(){}function u(){}function d(){}t=Object.getPrototypeOf;var f=[][o]?t(t([][o]())):(r(t={},o,function(){return this}),t),p=d.prototype=s.prototype=Object.create(f);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,r(e,i,"GeneratorFunction")),e.prototype=Object.create(p),e}return u.prototype=d,r(p,"constructor",d),r(d,"constructor",u),u.displayName="GeneratorFunction",r(d,i,"GeneratorFunction"),r(p),r(p,i,"Generator"),r(p,o,function(){return this}),r(p,"toString",function(){return"[object Generator]"}),(n=function(){return{w:c,m}})()}function r(e,t,n,a){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}r=function(e,t,n,a){function i(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},r(e,t,n,a)}function a(e,t,n,r,a,o,i){try{var c=e[o](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,a)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function c(e){a(i,r,o,c,l,"next",e)}function l(e){a(i,r,o,c,l,"throw",e)}c(void 0)})}}var i=null,c=0,l=null,s={player:0,banker:0,tie:0,playerPair:0,bankerPair:0,randomPair:0},u=0,d=!1,f=!1,p="/api/v1";function m(){console.log("[Game] Echo ready â€” subscribing to channels"),window.Echo.channel("game-table").listen(".round.started",function(e){console.log("[WS] round.started",e);var t=!l||l.round_id!==e.round_id;l=e,f=!1,t&&(_(),w()),"betting"===e.status?(k(),x(e.timer_seconds)):(I("Waiting for first bet..."),k())}).listen(".timer.tick",function(e){x(e.seconds_remaining)}).listen(".bet.placed",function(e){!function(e){var t=document.getElementById("activity-feed");if(t){var n=document.createElement("div");for(n.className="activity-item small py-1",n.textContent=e,t.prepend(n);t.children.length>5;)t.lastChild.remove()}}("ðŸŽ² "+e.player_name+" bet "+e.total_bet+" WPUFF"),j(e.active_players)}).listen(".cards.dealt",function(e){if(console.log("[WS] cards.dealt",e),!f&&(f=!0,l=Object.assign({},l,e),E(),I("Dealing cards..."),g(e),!d)){var t=(e.player_cards||e.playerCards||[]).length,n=(e.banker_cards||e.bankerCards||[]).length,r=1e3*Math.max(t,n)+1500+2e3;setTimeout(w,r)}}).listen(".round.finished",function(e){var t,n;console.log("[WS] round.finished",e),t=e.next_round_in,(n=document.getElementById("next-round-wrapper"))&&(n.classList.remove("d-none"),P("next-round-seconds",t,function(){n.classList.add("d-none")}))}),function(){if(!i)return;window.Echo.private("player."+i).listen(".round.result",function(e){console.log("[WS] round.result",e),c=e.new_balance,L();var t=l&&l.player_cards?l.player_cards.length:3,n=l&&l.banker_cards?l.banker_cards.length:3,r=1e3*Math.max(t,n)+1500;setTimeout(function(){!function(e){w();var t=document.getElementById("result-overlay"),n=document.getElementById("result-title"),r=document.getElementById("result-details");if(!t)return;t.classList.add("active"),n&&(n.textContent=(e.result||"").replace(/_/g," "));var a=e.profit||0;r&&(r.textContent=a>0?"You won +"+a+" WPUFF ðŸŽ‰":a<0?"You lost "+Math.abs(a)+" WPUFF ðŸ˜¢":"Tie â€” bet returned");P("result-countdown",5,function(){t.classList.remove("active")})}(e)},r)})}(),function(){y.apply(this,arguments)}()}function y(){return(y=o(n().m(function e(){var t,r,a,o;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,window.axios.get(p+"/game/state");case 1:t=e.v,r=t.data,(a=r.current_round)&&(l=a,f=!1,"betting"===a.round_status&&(k(),x(a.timer_remaining||0)),"dealing"===a.round_status&&a.player_cards&&a.player_cards.length&&(f=!0,E(),g({player_cards:a.player_cards,banker_cards:a.banker_cards,player_total:a.player_total,banker_total:a.banker_total}))),r.leaderboard&&S(r.leaderboard,r.active_players||{}),r.recent_activity&&T(r.recent_activity),j(Object.keys(r.active_players||{}).length),e.n=3;break;case 2:e.p=2,o=e.v,console.error("[Init] Failed to load game state:",o),I("Connection error â€” refresh to retry");case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function b(){return(b=o(n().m(function e(r){var a,o,i,f;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(l){e.n=1;break}return e.a(2,O("Loading..."));case 1:if("waiting"===(a=l.round_status||l.status)||"betting"===a){e.n=2;break}return e.a(2,O("Wait for the next round!"));case 2:if(0!==u){e.n=3;break}return e.a(2,O("Select a chip first!"));case 3:if(!("player"===(o=r.dataset.betType)&&s.banker>0)){e.n=4;break}return e.a(2,O("Cannot bet Player and Banker!"));case 4:if(!("banker"===o&&s.player>0)){e.n=5;break}return e.a(2,O("Cannot bet Player and Banker!"));case 5:if(i=Object.assign({},s,t({},o,s[o]+u)),!(Object.values(i).reduce(function(e,t){return e+t},0)>c)){e.n=6;break}return e.a(2,O("Insufficient balance!"));case 6:return s[o]+=u,c-=u,B(o),L(),d=!0,e.p=7,e.n=8,window.axios.post(p+"/game/bet",{round_id:l.id||l.round_id,bets:s});case 8:O("+"+u+" on "+o.toUpperCase()),e.n=10;break;case 9:e.p=9,f=e.v,s[o]-=u,c+=u,d=Object.values(s).some(function(e){return e>0}),B(o),L(),O(f.response&&f.response.data&&f.response.data.message?f.response.data.message:"Bet failed â€” try again"),console.error("[Bet]",f);case 10:return e.a(2)}},e,null,[[7,9]])}))).apply(this,arguments)}function v(){return(v=o(n().m(function e(){var t,r;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if("betting"===(l&&(l.round_status||l.status))){e.n=1;break}return e.a(2,O("Cannot clear bets now!"));case 1:if(0!==(t=Object.values(s).reduce(function(e,t){return e+t},0))){e.n=2;break}return e.a(2);case 2:return e.p=2,e.n=3,window.axios.post(p+"/game/clear",{round_id:l.id||l.round_id});case 3:r=e.v,c=r.data.balance,_(),L(),O("Cleared! "+t+" WPUFF refunded"),e.n=5;break;case 4:e.p=4,e.v,O("Could not clear bets");case 5:return e.a(2)}},e,null,[[2,4]])}))).apply(this,arguments)}function g(e){var t=document.getElementById("card-dealing-overlay"),n=document.getElementById("player-hand"),r=document.getElementById("banker-hand");if(t&&n&&r){t.classList.add("active"),n.innerHTML="",r.innerHTML="";var a=document.getElementById("player-total-score"),o=document.getElementById("banker-total-score");a&&(a.textContent="?"),o&&(o.textContent="?");var i=1e3,c=e.player_cards||e.playerCards||[],l=e.banker_cards||e.bankerCards||[];c.forEach(function(e,t){setTimeout(function(){h(n,e)},t*i)}),l.forEach(function(e,t){setTimeout(function(){h(r,e)},t*i+500)});var s=Math.max(c.length,l.length)*i+800;setTimeout(function(){a&&(a.textContent=null!=e.player_total?e.player_total:e.playerTotal||"?"),o&&(o.textContent=null!=e.banker_total?e.banker_total:e.bankerTotal||"?")},s)}}function h(e,t){var n=document.createElement("div");n.className="card-placeholder",n.textContent=t.display,n.style.color=-1!==["â™¥","â™¦"].indexOf(t.suit)?"#dc3545":"#212529",e.appendChild(n)}function w(){var e=document.getElementById("card-dealing-overlay"),t=document.getElementById("result-overlay");e&&e.classList.remove("active"),t&&t.classList.remove("active")}function _(){Object.keys(s).forEach(function(e){s[e]=0,B(e)}),document.querySelectorAll(".betting-box").forEach(function(e){e.classList.remove("disabled")}),d=!1}function k(){document.querySelectorAll(".betting-box").forEach(function(e){e.classList.remove("disabled")})}function E(){document.querySelectorAll(".betting-box").forEach(function(e){e.classList.add("disabled")})}function x(e){var t=document.getElementById("bet-timer");t&&(t.innerHTML='<i class="bi bi-clock-fill"></i> Time: <span class="fw-bold">'+e+"</span>s",t.classList.remove("text-success","text-warning","text-danger"),e<=5?t.classList.add("text-danger"):e<=10?t.classList.add("text-warning"):t.classList.add("text-success"))}function I(e){var t=document.getElementById("bet-timer");t&&(t.innerHTML='<i class="bi bi-clock-fill"></i> '+e)}document.addEventListener("DOMContentLoaded",function(){if(function(){var e=document.getElementById("game-app");if(!e)return;i=parseInt(e.dataset.playerId)||null,e.dataset.playerName||"Guest",c=parseInt(e.dataset.balance)||0,L()}(),window.echoReady&&window.Echo)m();else{document.addEventListener("echo:ready",m,{once:!0});var e=0,t=setInterval(function(){window.Echo?(clearInterval(t),document.removeEventListener("echo:ready",m),m()):++e>50&&(clearInterval(t),console.error("[Game] Echo not available after 5s â€” check app.js loaded before game.js"),I("WebSocket error â€” please refresh"))},100)}});var C={player:"player-total",banker:"banker-total",tie:"tie-total",playerPair:"player-pair-total",bankerPair:"banker-pair-total",randomPair:"random-pair-total"};function B(e){var t=document.getElementById(C[e]);t&&(t.textContent=s[e])}function L(){["player-balance","player-balance-side"].forEach(function(e){var t=document.getElementById(e);t&&(t.textContent=Number(c).toLocaleString())})}function j(e){var t=document.getElementById("player-count");t&&(t.textContent=e)}function S(e,t){var n=document.getElementById("leaderboard");if(n){var r=Object.keys(t||{}).map(Number);n.innerHTML=e.map(function(e,t){var n=e.id===i,a=-1!==r.indexOf(e.id);return'<div class="d-flex justify-content-between align-items-center py-1 border-bottom border-secondary small"><span class="text-warning fw-bold">#'+(t+1)+'</span><span class="'+(n?"text-warning fw-bold":"text-white")+'">'+F(e.player_name)+(a?" ðŸŸ¢":"")+'</span><span class="text-success fw-bold">'+Number(e.balance).toLocaleString()+"</span></div>"}).join("")}}function T(e){var t=document.getElementById("activity-feed");t&&(t.innerHTML=e.slice(0,5).map(function(e){return'<div class="activity-item small py-1">ðŸŽ² '+F(e.message)+"</div>"}).join(""))}function O(e){var t=document.getElementById("toast-container");if(t){var n=document.createElement("div");n.className="toast-msg alert alert-dark py-1 px-3 mb-1 small",n.textContent=e,t.appendChild(n),setTimeout(function(){n.remove()},3e3)}}function P(e,t,n){var r=t,a=document.getElementById(e),o=function(){a&&(a.textContent=r+"s"),r--<=0?n&&n():setTimeout(o,1e3)};o()}function F(e){return String(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}window.handleBetClick=function(e){return b.apply(this,arguments)},window.clearAllBets=function(){return v.apply(this,arguments)},window.selectChip=function(e){u=e,document.querySelectorAll(".chip").forEach(function(t){t.classList.toggle("active",parseInt(t.dataset.value)===e)})}})();
//# sourceMappingURL=game.js.map