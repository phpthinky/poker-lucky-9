{"version":3,"file":"/js/game.js","mappings":"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","sources":["webpack://lucky-puffin/./resources/js/game.js"],"sourcesContent":["/**\n * Lucky Puffin — game.js (Laravel Mix / Webpack)\n *\n * THE FIX: app.js and game.js are separate Webpack bundles.\n * window.Echo is created in app.js but game.js may run before it finishes.\n *\n * Solution: wait for 'echo:ready' custom event dispatched by app.js,\n * with a 100ms polling fallback in case scripts load out of order.\n */\n\n// ── State ─────────────────────────────────────────────────────────────────────\nlet playerId        = null;\nlet playerBalance   = 0;\nlet playerName      = null;\n\nlet currentRound    = null;\nlet currentBets     = { player: 0, banker: 0, tie: 0, playerPair: 0, bankerPair: 0, randomPair: 0 };\nlet selectedChip    = 0;\nlet hasBetThisRound = false;\nlet dealingShown    = false;\n\nconst API_BASE = '/api/v1';\n\n// ── Entry point ───────────────────────────────────────────────────────────────\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    readPlayerData();\n\n    if (window.echoReady && window.Echo) {\n        // app.js already finished — boot immediately\n        boot();\n    } else {\n        // Wait for app.js to signal Echo is ready\n        document.addEventListener('echo:ready', boot, { once: true });\n\n        // Fallback polling: check every 100ms, give up after 5s\n        let attempts = 0;\n        const poll = setInterval(() => {\n            if (window.Echo) {\n                clearInterval(poll);\n                document.removeEventListener('echo:ready', boot);\n                boot();\n            } else if (++attempts > 50) {\n                clearInterval(poll);\n                console.error('[Game] Echo not available after 5s — check app.js loaded before game.js');\n                setTimerLabel('WebSocket error — please refresh');\n            }\n        }, 100);\n    }\n});\n\nfunction readPlayerData() {\n    const app = document.getElementById('game-app');\n    if (!app) return;\n    playerId      = parseInt(app.dataset.playerId)  || null;\n    playerName    = app.dataset.playerName           || 'Guest';\n    playerBalance = parseInt(app.dataset.balance)    || 0;\n    updateBalanceDisplay();\n}\n\nfunction boot() {\n    console.log('[Game] Echo ready — subscribing to channels');\n    subscribeToGameTable();\n    subscribeToPlayerChannel();\n    fetchInitialState();\n}\n\n// ── WebSocket: Public channel ─────────────────────────────────────────────────\n\nfunction subscribeToGameTable() {\n    window.Echo.channel('game-table')\n\n        .listen('.round.started', (data) => {\n            console.log('[WS] round.started', data);\n            const isNewRound = !currentRound || currentRound.round_id !== data.round_id;\n            currentRound     = data;\n            dealingShown     = false;\n\n            if (isNewRound) {\n                clearBets();\n                hideOverlays();\n            }\n\n            if (data.status === 'betting') {\n                enableBetting();\n                updateTimerDisplay(data.timer_seconds);\n            } else {\n                setTimerLabel('Waiting for first bet...');\n                enableBetting();\n            }\n        })\n\n        .listen('.timer.tick', (data) => {\n            updateTimerDisplay(data.seconds_remaining);\n        })\n\n        .listen('.bet.placed', (data) => {\n            addActivityItem('\\uD83C\\uDFB2 ' + data.player_name + ' bet ' + data.total_bet + ' WPUFF');\n            setPlayerCount(data.active_players);\n        })\n\n        .listen('.cards.dealt', (data) => {\n            console.log('[WS] cards.dealt', data);\n            if (dealingShown) return;\n            dealingShown = true;\n            currentRound = Object.assign({}, currentRound, data);\n            disableBetting();\n            setTimerLabel('Dealing cards...');\n            showSharedCards(data);\n\n            if (!hasBetThisRound) {\n                const pLen   = (data.player_cards || data.playerCards || []).length;\n                const bLen   = (data.banker_cards || data.bankerCards || []).length;\n                const waitMs = (Math.max(pLen, bLen) * 1000) + 1500 + 2000;\n                setTimeout(hideOverlays, waitMs);\n            }\n        })\n\n        .listen('.round.finished', (data) => {\n            console.log('[WS] round.finished', data);\n            showNextRoundCountdown(data.next_round_in);\n        });\n}\n\n// ── WebSocket: Private player channel ────────────────────────────────────────\n\nfunction subscribeToPlayerChannel() {\n    if (!playerId) return;\n\n    window.Echo.private('player.' + playerId)\n        .listen('.round.result', (data) => {\n            console.log('[WS] round.result', data);\n            playerBalance = data.new_balance;\n            updateBalanceDisplay();\n\n            const pLen   = (currentRound && currentRound.player_cards) ? currentRound.player_cards.length : 3;\n            const bLen   = (currentRound && currentRound.banker_cards) ? currentRound.banker_cards.length : 3;\n            const animMs = (Math.max(pLen, bLen) * 1000) + 1500;\n            setTimeout(function () { showResult(data); }, animMs);\n        });\n}\n\n// ── REST: Initial page load ───────────────────────────────────────────────────\n\nasync function fetchInitialState() {\n    try {\n        const res   = await window.axios.get(API_BASE + '/game/state');\n        const data  = res.data;\n        const round = data.current_round;\n\n        if (round) {\n            currentRound = round;\n            dealingShown = false;\n\n            if (round.round_status === 'betting') {\n                enableBetting();\n                updateTimerDisplay(round.timer_remaining || 0);\n            }\n\n            if (round.round_status === 'dealing' && round.player_cards && round.player_cards.length) {\n                dealingShown = true;\n                disableBetting();\n                showSharedCards({\n                    player_cards: round.player_cards,\n                    banker_cards: round.banker_cards,\n                    player_total: round.player_total,\n                    banker_total: round.banker_total,\n                });\n            }\n        }\n\n        if (data.leaderboard)     renderLeaderboard(data.leaderboard, data.active_players || {});\n        if (data.recent_activity) renderActivityFeed(data.recent_activity);\n        setPlayerCount(Object.keys(data.active_players || {}).length);\n\n    } catch (err) {\n        console.error('[Init] Failed to load game state:', err);\n        setTimerLabel('Connection error — refresh to retry');\n    }\n}\n\n// ── Betting ───────────────────────────────────────────────────────────────────\n\nasync function handleBetClick(box) {\n    if (!currentRound) return showToast('Loading...');\n\n    const status = currentRound.round_status || currentRound.status;\n    if (status !== 'waiting' && status !== 'betting') {\n        return showToast('Wait for the next round!');\n    }\n    if (selectedChip === 0) return showToast('Select a chip first!');\n\n    const betType = box.dataset.betType;\n    if (betType === 'player' && currentBets.banker > 0) return showToast('Cannot bet Player and Banker!');\n    if (betType === 'banker' && currentBets.player > 0) return showToast('Cannot bet Player and Banker!');\n\n    const projected = Object.assign({}, currentBets, { [betType]: currentBets[betType] + selectedChip });\n    const newTotal  = Object.values(projected).reduce(function (s, v) { return s + v; }, 0);\n    if (newTotal > playerBalance) return showToast('Insufficient balance!');\n\n    // Optimistic update\n    currentBets[betType] += selectedChip;\n    playerBalance        -= selectedChip;\n    updateBetDisplay(betType);\n    updateBalanceDisplay();\n    hasBetThisRound = true;\n\n    try {\n        await window.axios.post(API_BASE + '/game/bet', {\n            round_id: currentRound.id || currentRound.round_id,\n            bets:     currentBets,\n        });\n        showToast('+' + selectedChip + ' on ' + betType.toUpperCase());\n    } catch (err) {\n        // Roll back\n        currentBets[betType] -= selectedChip;\n        playerBalance        += selectedChip;\n        hasBetThisRound       = Object.values(currentBets).some(function (v) { return v > 0; });\n        updateBetDisplay(betType);\n        updateBalanceDisplay();\n        const msg = err.response && err.response.data && err.response.data.message\n            ? err.response.data.message\n            : 'Bet failed — try again';\n        showToast(msg);\n        console.error('[Bet]', err);\n    }\n}\n\nasync function clearAllBets() {\n    const status = (currentRound && (currentRound.round_status || currentRound.status));\n    if (status !== 'betting') return showToast('Cannot clear bets now!');\n\n    const total = Object.values(currentBets).reduce(function (s, v) { return s + v; }, 0);\n    if (total === 0) return;\n\n    try {\n        const res = await window.axios.post(API_BASE + '/game/clear', {\n            round_id: currentRound.id || currentRound.round_id,\n        });\n        playerBalance = res.data.balance;\n        clearBets();\n        updateBalanceDisplay();\n        showToast('Cleared! ' + total + ' WPUFF refunded');\n    } catch (err) {\n        showToast('Could not clear bets');\n    }\n}\n\n// ── Card animation ────────────────────────────────────────────────────────────\n\nfunction showSharedCards(data) {\n    const overlay = document.getElementById('card-dealing-overlay');\n    const pHand   = document.getElementById('player-hand');\n    const bHand   = document.getElementById('banker-hand');\n    if (!overlay || !pHand || !bHand) return;\n\n    overlay.classList.add('active');\n    pHand.innerHTML = '';\n    bHand.innerHTML = '';\n    var pScore = document.getElementById('player-total-score');\n    var bScore = document.getElementById('banker-total-score');\n    if (pScore) pScore.textContent = '?';\n    if (bScore) bScore.textContent = '?';\n\n    const DELAY  = 1000;\n    const pCards = data.player_cards || data.playerCards || [];\n    const bCards = data.banker_cards || data.bankerCards || [];\n\n    pCards.forEach(function (card, i) {\n        setTimeout(function () { appendCard(pHand, card); }, i * DELAY);\n    });\n    bCards.forEach(function (card, i) {\n        setTimeout(function () { appendCard(bHand, card); }, (i * DELAY) + 500);\n    });\n\n    const totalMs = Math.max(pCards.length, bCards.length) * DELAY + 800;\n    setTimeout(function () {\n        if (pScore) pScore.textContent = data.player_total != null ? data.player_total : (data.playerTotal || '?');\n        if (bScore) bScore.textContent = data.banker_total != null ? data.banker_total : (data.bankerTotal || '?');\n    }, totalMs);\n}\n\nfunction appendCard(container, card) {\n    const el       = document.createElement('div');\n    el.className   = 'card-placeholder';\n    el.textContent = card.display;\n    el.style.color = ['♥', '♦'].indexOf(card.suit) !== -1 ? '#dc3545' : '#212529';\n    container.appendChild(el);\n}\n\nfunction showResult(data) {\n    hideOverlays();\n\n    const resultEl  = document.getElementById('result-overlay');\n    const titleEl   = document.getElementById('result-title');\n    const detailsEl = document.getElementById('result-details');\n    if (!resultEl) return;\n\n    resultEl.classList.add('active');\n    if (titleEl)   titleEl.textContent = (data.result || '').replace(/_/g, ' ');\n\n    var profit = data.profit || 0;\n    if (detailsEl) {\n        detailsEl.textContent = profit > 0\n            ? 'You won +' + profit + ' WPUFF \\uD83C\\uDF89'\n            : profit < 0\n                ? 'You lost ' + Math.abs(profit) + ' WPUFF \\uD83D\\uDE22'\n                : 'Tie \\u2014 bet returned';\n    }\n\n    startCountdown('result-countdown', 5, function () {\n        resultEl.classList.remove('active');\n    });\n}\n\nfunction showNextRoundCountdown(seconds) {\n    var wrapper = document.getElementById('next-round-wrapper');\n    if (!wrapper) return;\n    wrapper.classList.remove('d-none');\n    startCountdown('next-round-seconds', seconds, function () {\n        wrapper.classList.add('d-none');\n    });\n}\n\nfunction hideOverlays() {\n    var d = document.getElementById('card-dealing-overlay');\n    var r = document.getElementById('result-overlay');\n    if (d) d.classList.remove('active');\n    if (r) r.classList.remove('active');\n}\n\n// ── UI helpers ────────────────────────────────────────────────────────────────\n\nfunction clearBets() {\n    Object.keys(currentBets).forEach(function (k) { currentBets[k] = 0; updateBetDisplay(k); });\n    document.querySelectorAll('.betting-box').forEach(function (b) { b.classList.remove('disabled'); });\n    hasBetThisRound = false;\n}\n\nfunction enableBetting()  {\n    document.querySelectorAll('.betting-box').forEach(function (b) { b.classList.remove('disabled'); });\n}\nfunction disableBetting() {\n    document.querySelectorAll('.betting-box').forEach(function (b) { b.classList.add('disabled'); });\n}\n\nfunction updateTimerDisplay(seconds) {\n    var el = document.getElementById('bet-timer');\n    if (!el) return;\n    el.innerHTML = '<i class=\"bi bi-clock-fill\"></i> Time: <span class=\"fw-bold\">' + seconds + '</span>s';\n    el.classList.remove('text-success', 'text-warning', 'text-danger');\n    if (seconds <= 5)       el.classList.add('text-danger');\n    else if (seconds <= 10) el.classList.add('text-warning');\n    else                    el.classList.add('text-success');\n}\n\nfunction setTimerLabel(text) {\n    var el = document.getElementById('bet-timer');\n    if (el) el.innerHTML = '<i class=\"bi bi-clock-fill\"></i> ' + text;\n}\n\nvar BET_DISPLAY_MAP = {\n    player:     'player-total',\n    banker:     'banker-total',\n    tie:        'tie-total',\n    playerPair: 'player-pair-total',\n    bankerPair: 'banker-pair-total',\n    randomPair: 'random-pair-total',\n};\n\nfunction updateBetDisplay(betType) {\n    var el = document.getElementById(BET_DISPLAY_MAP[betType]);\n    if (el) el.textContent = currentBets[betType];\n}\n\nfunction updateBalanceDisplay() {\n    ['player-balance', 'player-balance-side'].forEach(function (id) {\n        var el = document.getElementById(id);\n        if (el) el.textContent = Number(playerBalance).toLocaleString();\n    });\n}\n\nfunction setPlayerCount(n) {\n    var el = document.getElementById('player-count');\n    if (el) el.textContent = n;\n}\n\nfunction renderLeaderboard(leaders, activePlayers) {\n    var el = document.getElementById('leaderboard');\n    if (!el) return;\n    var activeIds = Object.keys(activePlayers || {}).map(Number);\n    el.innerHTML = leaders.map(function (p, i) {\n        var isMe     = p.id === playerId;\n        var isActive = activeIds.indexOf(p.id) !== -1;\n        return '<div class=\"d-flex justify-content-between align-items-center py-1 border-bottom border-secondary small\">'\n            + '<span class=\"text-warning fw-bold\">#' + (i + 1) + '</span>'\n            + '<span class=\"' + (isMe ? 'text-warning fw-bold' : 'text-white') + '\">'\n            + escHtml(p.player_name) + (isActive ? ' \\uD83D\\uDFE2' : '')\n            + '</span>'\n            + '<span class=\"text-success fw-bold\">' + Number(p.balance).toLocaleString() + '</span>'\n            + '</div>';\n    }).join('');\n}\n\nfunction renderActivityFeed(items) {\n    var el = document.getElementById('activity-feed');\n    if (!el) return;\n    el.innerHTML = items.slice(0, 5).map(function (a) {\n        return '<div class=\"activity-item small py-1\">\\uD83C\\uDFB2 ' + escHtml(a.message) + '</div>';\n    }).join('');\n}\n\nfunction addActivityItem(message) {\n    var el = document.getElementById('activity-feed');\n    if (!el) return;\n    var item     = document.createElement('div');\n    item.className   = 'activity-item small py-1';\n    item.textContent = message;\n    el.prepend(item);\n    while (el.children.length > 5) el.lastChild.remove();\n}\n\nfunction showToast(msg) {\n    var container = document.getElementById('toast-container');\n    if (!container) return;\n    var el     = document.createElement('div');\n    el.className   = 'toast-msg alert alert-dark py-1 px-3 mb-1 small';\n    el.textContent = msg;\n    container.appendChild(el);\n    setTimeout(function () { el.remove(); }, 3000);\n}\n\nfunction startCountdown(elementId, seconds, onDone) {\n    var count = seconds;\n    var el    = document.getElementById(elementId);\n    var tick  = function () {\n        if (el) el.textContent = count + 's';\n        if (count-- <= 0) { if (onDone) onDone(); }\n        else setTimeout(tick, 1000);\n    };\n    tick();\n}\n\nfunction escHtml(str) {\n    return String(str || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\n}\n\n// ── Expose for Blade onclick= attributes ─────────────────────────────────────\n\nwindow.handleBetClick = handleBetClick;\nwindow.clearAllBets   = clearAllBets;\nwindow.selectChip     = function (amount) {\n    selectedChip = amount;\n    document.querySelectorAll('.chip').forEach(function (c) {\n        c.classList.toggle('active', parseInt(c.dataset.value) === amount);\n    });\n};\n"],"names":["e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","w","m","defineProperty","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","playerId","playerBalance","currentRound","currentBets","player","banker","tie","playerPair","bankerPair","randomPair","selectedChip","hasBetThisRound","dealingShown","API_BASE","boot","console","log","window","Echo","channel","listen","data","isNewRound","round_id","clearBets","hideOverlays","status","enableBetting","updateTimerDisplay","timer_seconds","setTimerLabel","seconds_remaining","message","el","document","getElementById","item","createElement","className","textContent","prepend","children","lastChild","remove","addActivityItem","player_name","total_bet","setPlayerCount","active_players","assign","disableBetting","showSharedCards","pLen","player_cards","playerCards","bLen","banker_cards","bankerCards","waitMs","Math","max","setTimeout","seconds","wrapper","next_round_in","classList","startCountdown","add","new_balance","updateBalanceDisplay","animMs","resultEl","titleEl","detailsEl","result","replace","profit","abs","showResult","subscribeToPlayerChannel","_fetchInitialState","fetchInitialState","_callee","res","round","_t","_context","axios","get","current_round","round_status","timer_remaining","player_total","banker_total","leaderboard","renderLeaderboard","recent_activity","renderActivityFeed","keys","error","_handleBetClick","_callee2","box","betType","projected","_t2","_context2","showToast","dataset","_defineProperty","values","reduce","s","updateBetDisplay","post","id","bets","toUpperCase","some","response","_clearAllBets","_callee3","total","_context3","balance","overlay","pHand","bHand","innerHTML","pScore","bScore","DELAY","pCards","bCards","forEach","card","appendCard","totalMs","playerTotal","bankerTotal","container","display","style","color","indexOf","suit","appendChild","k","querySelectorAll","b","text","addEventListener","app","parseInt","playerName","readPlayerData","echoReady","once","attempts","poll","setInterval","clearInterval","removeEventListener","BET_DISPLAY_MAP","Number","toLocaleString","leaders","activePlayers","activeIds","map","isMe","isActive","escHtml","join","items","slice","msg","elementId","onDone","count","tick","str","String","handleBetClick","_x","clearAllBets","selectChip","amount","toggle"],"sourceRoot":""}